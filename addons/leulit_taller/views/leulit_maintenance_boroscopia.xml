<?xml version='1.0' encoding='utf-8'?>
<odoo>
    
    <record id="leulit_20240212_1600_form" model="ir.ui.view">
        <field name="name">leulit_20240212_1600_form</field>
        <field name="model">leulit.maintenance_boroscopia</field>
        <field name="arch" type="xml">
            <form string="Boroscopia">
                <header>
                    <button name="set_estado_firmado_boroscopia" string="Firmar IT" type="object" class="oe_highlight"  invisible="((estado != 'borrador'))"  groups="leulit.RolIT_developer"/>
                    <button name="set_estado_borrador_boroscopia" string="Pendiente IT" type="object" class="oe_highlight"  invisible="((estado == 'borrador'))"  groups="leulit.RolIT_developer"/>
                    <button name="set_estado_pendiente_firma_boroscopia" string="Firmar" type="object" class="oe_highlight"  invisible="((estado != 'borrador'))" />
                    <button name="create_form_one_from_boroscopia" string="Crear Form One" type="object" class="oe_highlight"  invisible="((estado != 'firmado') or (flag_form_one))" />
                    <button name="print_boroscopia" string="Imprimir" type="object" class="oe_highlight"/>
                    <field name="estado" widget="statusbar"/>
                </header>
                <sheet>
                    <field name="form_one_ids" invisible="1"/>
                    <field name="flag_form_one" invisible="1"/>
                    <field name="request" invisible="1"/>
                    <field name="name" invisible="1"/>
                    <separator string="Datos Aeronave"/>
                    <group col="4">
                        <field name="helicoptero"  readonly="((estado != 'borrador'))"  options="{'no_create': True, 'create': False, 'edit': False, 'no_open':true}"/>
                        <field name="modelo"/>
                        <field name="fabricante"/>
                        <field name="serialnum"/>
                        <field name="tsn"  readonly="((estado != 'borrador'))" />
                    </group>
                    <separator string="Datos Boroscopia"/>
                    <group col="4">
                        <field name="task" options="{'no_create': True, 'create': False, 'edit': False, 'no_open':true}"/>
                        <field name="mecanico" options="{'no_create': True, 'create': False, 'edit': False, 'no_open':true}"  readonly="((estado != 'borrador'))" />
                        <field name="lugar"  readonly="((estado != 'borrador'))" />
                        <field name="fecha"  readonly="((estado != 'borrador'))" />
                    </group>
                    <separator name="resultado" string="Resultado Inspección"/>
                    <field name="resultado_inspeccion" widget="html"  readonly="((estado != 'borrador'))" />
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record id="leulit_20240212_1600_tree" model="ir.ui.view">
        <field name="name">leulit_20240212_1600_tree</field>
        <field name="model">leulit.maintenance_boroscopia</field>
        <field name="arch" type="xml">
            <tree string="Boroscopias" create="false">
                <field name="name"/>
                <field name="lugar"/>
                <field name="fecha"/>
                <field name="mecanico"/>
                <field name="estado"/>
            </tree>
        </field>
    </record>

    <record id="leulit_20240212_1600_action" model="ir.actions.act_window">
        <field name="name">Listado de Boroscopias</field>
        <field name="res_model">leulit.maintenance_boroscopia</field>
        <field name="view_mode">tree,form</field>
    </record>
        
    
    <record id="leulit_20240212_1600_tree" model="ir.ui.view">
        <field name="name">leulit_20240212_1600_tree</field>
        <field name="model">leulit.maintenance_boroscopia</field>
        <field name="arch" type="xml">
            <tree string="CRS">
                <field name="lugar"/>
                <field name="fecha"/>
                <field name="mecanico"/>
                <field name="estado"/>
            </tree>
        </field>
    </record>


    <!-- REPORT CRS -->
    <report
        id="leulit_20240214_0956_report"
        string="Boroscopia"
        model="leulit.maintenance_boroscopia"
        report_type="qweb-pdf"
        name="leulit_taller.leulit_20240214_0956_informe"
        file="leulit_taller.leulit_20240214_0956_informe"
        paperformat="leulit.paperformat_A4_portrait_without_cabecera"
    />



    <template id="boroscopia_report_header">
        <table class="fullwidth noborde">
            <tr>
                <th class="noborde">
                    <table class="noborde">
                        <tr>
                            <td class="noborde" style="font-size:8px; white-space: nowrap; text-align:center">(c) Icarus Manteniment</td>
                            <td class="noborde" style="font-size:8px; white-space: nowrap; text-align:center">
                                <i>Fecha creación documento</i><br/>
                                <i><span t-esc="item['fecha']"/></i>
                            </td>
                            <td class="noborde" style="font-size:8px; white-space: nowrap; text-align:center">
                                <t t-if="hashcode">
                                    <i>Firmado por:</i><br/>
                                    <i><span t-esc="firmado_por"/></i>
                                </t>
                            </td>
                            <td class="noborde" style="font-size:8px; white-space: nowrap; text-align:center">
                                <t t-if="hashcode">
                                    <i>CSV/CID</i><br/>
                                    <span t-esc="hashcode"/>
                                </t>
                                <t t-if="not hashcode">
                                    <i>Referencia</i><br/>
                                    <span t-esc="hashcode_interno"/>
                                </t>
                            </td>
                        </tr>
                    </table>
                </th>
                <th class="noborde">
                    <table align="right">
                        <tr>
                            <td style="font-size:8px; white-space: nowrap; text-align:center" class="noborde"><b>Código:</b></td>
                            <td style="font-size:8px; white-space: nowrap; text-align:center" class="noborde">HLP-DOC-0011</td>
                            <td style="font-size:8px; white-space: nowrap; text-align:center" class="noborde"><b>Versión:</b></td>
                            <td style="font-size:8px; white-space: nowrap; text-align:center" class="noborde">1.1.0</td>
                        </tr>
                    </table>
                </th>
            </tr>
            <tr>
                <th class="noborde" colspan="2" style="border-top: 1px solid #575757;">
                    <table class="fullwidth noborde" style="margin-bottom: 30px">
                        <tbody>
                            <tr class="noborde">
                                <td colspan="2" class="noborde" style="font-size:8px;width:100%; text-align:center">
                                    Cualquier copia total o parcial de este documento se considera copia no controlada y siempre deberá ser contrastada con la información vigente en la intranet. (https://erp.helipistas.com/verifycsv)
                                </td>
                            </tr>
                            <tr class="noborde">
                                <td class="noborde">
                                    <table class="fullwidth">
                                        <tr>
                                            <td class="noborde" style="font-size:12px; width:15%; white-space: nowrap; text-align:left">
                                                <img t-att-src="'data:image/png;base64,%s' % to_text(logo_ica)" style="width:auto;height:25px;"/><br/>
                                            </td>
                                            <td class="noborde" style="font-size:20px; white-space: nowrap; text-align:center">
                                                <span><b>Informe de Boroscopia</b></span><br/>
                                            </td>
                                            <td class="noborde" style="font-size:12px; width:15%; white-space: nowrap; text-align:center">
                                                <span>M.O.E  2.16</span>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </th>
            </tr>
        </table>
    </template>   


    <template id="boroscopia_report_css">
        <style>
            html {
                font-family: sans-serif; /* 1 */
                -ms-text-size-adjust: 100%; /* 2 */
                -webkit-text-size-adjust: 100%; /* 2 */
            }
            .fullwidth {
                width: 100%;
                border-collapse: collapse;
            }
            .noborde {
                border: 0px none;
            }
            .theadtitle {
                font-weight: bold;
                font-size: 3.5687mm !important;
                text-transform: uppercase;
            }
            .literal {
                font-size: 3.5687mm;
            }
            .fieldvalue {
                font-weight: normal;
                font-size: 3.5687mm;
            }
            .numericfieldvalue {
                font-weight: normal;
                font-size: 3.5687mm;
            }
            .page {
                %if hashcode:
                    background: url(https://s3-eu-west-1.amazonaws.com/helimisc/helipistas-marca-agua.jpg) no-repeat 50% 50%;
                %else:
                    background: url(https://s3-eu-west-1.amazonaws.com/helimisc/helipistas-marca-agua-informe-interno-2.jpg) no-repeat 50% 50%;
                %endif
                width: 230mm;
                height: 320mm;
                margin: 0.5mm 0.5mm 0.5mm 0.5mm;  
                page-break-after: always;
            }
            .pagecontent {
                width: 230mm;
                height: 320mm;
            }
                .tdcolored {
                    background-color: rgba(0,0,0,0.40);
                    color: #ffffff;
                }
                .tdcoloredmain {
                    background-color: rgba(0,0,0,1);
                    color: #ffffff;
                }
            .centertext {text-align:center;}
            .nowrap {white-space: nowrap;}
            thead { display: table-header-group }
            tfoot { display: table-header-group }
            tr { page-break-inside: avoid }
            th, tbody td, tfoot td {
                border: 1px solid #EEEEEE;
                padding-right:3px;
                padding-left:3px;
                padding-top:3px;
                padding-bottom:3px;
                text-align:left;
                font-size:12px;
                font-weight:normal;
            }
            td{
                vertical-align: middle
            }
        </style>
    </template>

    <template id="leulit_20240214_0956_informe">
        <t t-call="web.html_container">
            <div class="page">
                <t t-set="cont" t-value="1"/>
                <t t-foreach="boroscopialist" t-as="item">
                    <t t-call="leulit_taller.boroscopia_report_css"/>
                    <t t-call="leulit_taller.boroscopia_report_header" />
                    <div class="row">
                        <table class="fullwidth">
                            <tr>
                                <td class="tdcolored theadtitle" >
                                    Datos aeronave / Aircraft data
                                </td>
                            </tr>
                        </table>
                        <table class="fullwidth">
                            <tr>
                                <th class="centertext tdcolored literal">Matrícula</th>
                                <th class="centertext tdcolored literal">Marca</th>
                                <th class="centertext tdcolored literal">Modelo</th>
                                <th class="centertext tdcolored literal">S/N</th>
                                <th class="centertext tdcolored literal">TSN</th>
                                <th class="centertext tdcolored literal">O.T.</th>
                            </tr>
                            <tr>
                                <td class="centertext fieldvalue"><span t-esc="item['matricula']"/></td>
                                <td class="centertext fieldvalue"><span t-esc="item['marca']"/></td>
                                <td class="centertext fieldvalue"><span t-esc="item['modelo']"/></td>
                                <td class="centertext fieldvalue"><span t-esc="item['sn']"/></td>
                                <td class="centertext numericfieldvalue"><span t-esc="item['tsn']"/></td>
                                <td class="centertext fieldvalue"><span t-esc="item['ot']"/></td>
                            </tr>
                        </table>
                        <table class="fullwidth">
                            <tr>
                                <td class="tdcolored theadtitle" >
                                    Herramientas / Tools
                                </td>
                            </tr>
                        </table>
                        <table class="fullwidth">
                            <tr>
                                <td class="centertext tdcolored literal">P/N</td>
                                <td class="centertext tdcolored literal">S/N</td>
                                <td class="centertext tdcolored literal">Fabricante</td>
                            </tr>
                            <t t-foreach="item['herramientas']" t-as="tool">
                                <tr>
                                    <td class="centertext fieldvalue"><span t-esc="tool['pn']"/></td>
                                    <td class="centertext fieldvalue"><span t-esc="tool['sn']"/></td>
                                    <td class="centertext fieldvalue"><span t-esc="tool['fabricante']"/></td>
                                </tr>
                            </t>
                        </table>
                        <table class="fullwidth">
                            <tr>
                                <td class="tdcolored literal">Resultado de la Inspección</td>
                            </tr>
                            <tr>
                                <td class="fieldvalue"><span t-raw="item['resultado_inspeccion']"/></td>
                            </tr>
                        </table>
                        <t t-if="cont == num_pages">
                            <table class="fullwidth">
                                <tr>
                                    <th class="centertext tdcolored literal">Nombre</th>
                                    <th class="centertext tdcolored literal">Lugar</th>
                                    <th class="centertext tdcolored literal">Técnico Certificador</th>
                                </tr>
                                <tr>
                                    <td class="centertext fieldvalue"><span t-esc="item['name']"/></td>
                                    <td class="centertext fieldvalue"><span t-esc="item['lugar']"/><br/><span t-esc="item['fecha']"/></td>
                                    <td class="centertext fieldvalue"><span t-esc="item['certificador']"/></td>
                                </tr>
                            </table>
                        </t>
                        <t t-else="">
                            <table class="fullwidth" style="page-break-after: always;">
                                <tr>
                                    <th class="centertext tdcolored literal">Nombre</th>
                                    <th class="centertext tdcolored literal">Lugar</th>
                                    <th class="centertext tdcolored literal">Técnico Certificador</th>
                                </tr>
                                <tr>
                                    <td class="centertext fieldvalue"><span t-esc="item['name']"/></td>
                                    <td class="centertext fieldvalue"><span t-esc="item['lugar']"/><br/><span t-esc="item['fecha']"/></td>
                                    <td class="centertext fieldvalue"><span t-esc="item['certificador']"/></td>
                                </tr>
                            </table>
                        </t>
                        <t t-set="cont" t-value="cont+1"/>
                    </div> 
                    <div class="footer">
                        <div class="row text-center" style="border-top: 1px solid black;">
                            <div class="col col-3 offset-9 text-right">
                                <ul class="list-inline mt-2">
                                    <li class="list-inline-item" style="font-size:10px;">Página:</li>
                                    <li class="list-inline-item">
                                        <span style="font-size:10px;">I-</span><span class="page" style="font-size:10px;"/>
                                    </li>
                                    <li class="list-inline-item" style="font-size:10px;">de</li>
                                    <li class="list-inline-item">
                                        <span style="font-size:10px;">I-</span><span class="topage" style="font-size:10px;"/>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div> 
                </t>
            </div>
        </t>
    </template>

</odoo>